mission_id: "M009-lot1"
title: "M009 Lot 1 — DryRun: préparer .family pour 3 providers plant_intelligence"
description: |
  Audit + préparation non-destructive (DryRun) des scaffolds .family pour:
  - plantEvolutionHistoryProvider
  - latestEvolutionProvider
  - filteredEvolutionHistoryProvider

  La mission:
  - régénère provider_calls_report.csv et provider_family_report.csv
  - génère suggestions (.ai-doc/patches/)
  - exécute apply_provider_patches.ps1 en mode -DryRun pour les 3 providers
  - crée un fichier d'issue pour collisions (gardenBedProvider)
priority: high
max_files: 8
max_lines: 1200
files:
  - path: ".ai-doc/issues/provider_collisions_m009.md"
    action: create
    encoding: text
    content: |
      # provider_collisions_m009.md

      date: {{DATE}}
      summary: Collision détectée pour `gardenBedProvider` — intervention manuelle requise.

      details:
      - provider: gardenBedProvider
      - defined_in: lib/features/garden_bed/providers/garden_bed_provider.dart:311 (NotifierProvider)
      - first_conflicting_call: lib/features/garden_bed/providers/garden_bed_scoped_provider.dart:17 (FutureProvider.family)
      - suggested_action:
        1. Ne pas convertir automatiquement.
        2. Triage manuel: décider si `gardenBedProvider` devient `.family(gardenId)` ou si on renomme le provider scopié.
        3. Créer branche `triage/provider_collisions_m009` et documenter les modifications.
      refs:
      - .ai-doc/patches/gardenBedProvider.md
commands:
  - "git status --porcelain"
  - "git fetch --all"
  - "git checkout main"
  - "flutter pub get"
  - "flutter pub run build_runner build --delete-conflicting-outputs"
  - "powershell -ExecutionPolicy Bypass -File .scripts/detect_provider_calls.ps1"
  - "powershell -ExecutionPolicy Bypass -File .scripts/analyze_provider_families.ps1"
  - "powershell -ExecutionPolicy Bypass -File .scripts/generate_provider_patches.ps1"
  - "powershell -ExecutionPolicy Bypass -File .scripts/apply_provider_patches.ps1 -Providers \"plantEvolutionHistoryProvider,latestEvolutionProvider,filteredEvolutionHistoryProvider\" -DryRun"
tests:
  - command: "flutter test"
    expect: "no_errors"
commit:
  message: "M009: prepared scaffolds .family (DryRun) for plantEvolutionHistoryProvider, latestEvolutionProvider, filteredEvolutionHistoryProvider; added collisions issue"
  files:
    - ".ai-doc/issues/provider_collisions_m009.md"
    - ".ai-doc/applied_patches/*.patch.md"
artifacts_to_return:
  - "provider_calls_report.csv"
  - "provider_family_report.csv"
  - ".ai-doc/patches/*.md"
  - ".ai-doc/applied_patches/*.patch.md"
  - "stdout"
  - "git_status"
  - "git_rev"
notes: |
  - DryRun is non-destructive: the apply script will create scaffolds and .ai-doc/applied_patches/*.patch.md records.
  - Do not push force to main during this mission.
  - Ensure PowerShell scripts are UTF-8 (no BOM) to avoid parsing issues.
