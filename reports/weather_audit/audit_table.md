# Weather System Audit Table

**Mission:** READ-WEATHER-20251102_173648  
**Date:** 2025-11-02

## File Inventory by Category

### Core Services (3 files)

| File Path | Type | Line Count | Key Components | Notes |
|-----------|------|------------|-----------------|-------|
| `lib/core/services/open_meteo_service.dart` | Service | 420 | OpenMeteoService singleton; fetchPrecipitation(); resolveCoordinates(); searchPlaces() | Main API integration; 30min cache; 3-retry mechanism |
| `lib/core/services/weather_impact_analyzer.dart` | Service | 850+ | WeatherImpactAnalyzer; analyzeImpact(); _detectWeatherAlertsProactive() | Plant-aware weather impact analysis |
| `lib/core/services/weather_alert_service.dart` | Service | 196 | WeatherAlertService; generateAlerts(); Smart watering alerts | Frost/Heatwave/Drought thresholds |

### Models (4 files)

| File Path | Type | Line Count | Key Components | Notes |
|-----------|------|------------|-----------------|-------|
| `lib/core/models/daily_weather_point.dart` | Data Model | 129 | DailyWeatherPoint; fromRaw(); fromEnriched() | Unified model for raw and enriched data |
| `lib/features/climate/domain/models/weather_view_data.dart` | Data Model | Unknown | WeatherViewData | UI-ready weather data model |
| `lib/features/plant_intelligence/domain/entities/weather_condition.dart` | Domain Entity | 184 | WeatherCondition (Freezed); WeatherType enum; WeatherImpact | Freezed entity with JSON serialization |
| `lib/core/services/models/composite_weather_data.dart` | Helper Model | Unknown | CompositeWeatherData | Composite weather data helper |

### Repositories & Data Sources (3 files)

| File Path | Type | Line Count | Key Components | Notes |
|-----------|------|------------|-----------------|-------|
| `lib/features/plant_intelligence/domain/repositories/i_weather_repository.dart` | Interface | 45 | IWeatherRepository; saveWeatherCondition(); getCurrentWeatherCondition(); getWeatherHistory() | Domain interface for weather operations |
| `lib/features/plant_intelligence/data/datasources/weather_datasource.dart` | Data Source | 150+ | WeatherDataSource; WeatherDataSourceImpl; getCurrentWeather(); getWeatherHistory() | Converts API data to WeatherCondition |
| `lib/features/plant_intelligence/data/repositories/plant_intelligence_repository_impl.dart` | Implementation | 315+ | PlantIntelligenceRepositoryImpl; Implements IWeatherRepository; Caching logic | 30min cache validity; Integrates with GardenAggregationHub |

### Providers (3 files)

| File Path | Type | Line Count | Key Components | Notes |
|-----------|------|------------|-----------------|-------|
| `lib/features/climate/presentation/providers/weather_providers.dart` | Riverpod Provider | 566 | currentWeatherProvider; forecastProvider; weatherAlertsProvider; selectedCommuneCoordinatesProvider | Main weather providers |
| `lib/features/climate/presentation/providers/hourly_weather_provider.dart` | Riverpod Provider | 125+ | Hourly weather provider | Hourly weather data |
| `lib/features/climate/presentation/providers/weather_alert_provider.dart` | Riverpod Provider | 59 | Weather alert provider | Alert management |

### UI Components (5 files)

| File Path | Type | Line Count | Key Components | Notes |
|-----------|------|------------|-----------------|-------|
| `lib/shared/presentation/widgets/weather_bubble_widget.dart` | Widget | 110+ | WeatherBubbleWidget (ConsumerWidget) | Displays current weather bubble |
| `lib/features/climate/presentation/screens/weather_detail_screen.dart` | Screen | Unknown | WeatherDetailScreen | Detailed weather view |
| `lib/features/climate/presentation/screens/climate_forecast_history_screen.dart` | Screen | Unknown | ClimateForecastHistoryScreen | Forecast and history visualization |
| `lib/shared/presentation/widgets/settings/weather_settings_section.dart` | Widget | Unknown | WeatherSettingsSection | Weather settings UI |
| `lib/features/climate/presentation/anim/weather_halo_controller.dart` | Animation | Unknown | WeatherHaloController | Weather animation controller |

### Utilities (1 file)

| File Path | Type | Line Count | Key Components | Notes |
|-----------|------|------------|-----------------|-------|
| `lib/core/utils/weather_icon_mapper.dart` | Mapper | 132 | WeatherIconMapper; getIconPath(); getWeatherDescription() | Maps WMO codes to icons |

### Generated Files (3 files)

| File Path | Type | Line Count | Key Components | Notes |
|-----------|------|------------|-----------------|-------|
| `lib/features/plant_intelligence/domain/entities/weather_condition.g.dart` | Code Gen | Unknown | JSON serialization code | Generated by json_serializable |
| `lib/features/plant_intelligence/domain/entities/weather_condition.freezed.dart` | Code Gen | Unknown | Freezed code | Generated by freezed |
| `lib/features/plant_intelligence/domain/entities/weather_condition_hive.g.dart` | Code Gen | Unknown | Hive adapter code | Generated by hive_generator |

### Test Files (1 file)

| File Path | Type | Line Count | Key Components | Notes |
|-----------|------|------------|-----------------|-------|
| `test/features/climate/presentation/weather_providers_commune_sync_test.dart` | Unit Test | Unknown | Provider sync tests | Test file for weather providers |

### Assets (2 directories)

| Path | Type | Contents | Notes |
|------|------|----------|-------|
| `assets/weather/` | Directory | Weather assets | Asset directory |
| `assets/weather_icons/` | Directory | Weather icons | Icon pack directory |

### Configuration (1 file)

| File Path | Type | Key Entries | Notes |
|-----------|------|-------------|-------|
| `pubspec.yaml` | Config | geolocator: ^14.0.2; assets/weather/; assets/weather_icons/ | No dedicated weather package (removed G8) |

## Summary Statistics

- **Total Files:** 23+ files
- **Core Services:** 3 files
- **Models:** 4 files
- **Repositories:** 3 files
- **Providers:** 3 files
- **UI Components:** 5 files
- **Utilities:** 1 file
- **Generated:** 3 files
- **Tests:** 1 file
- **Assets:** 2 directories

## Key Patterns Identified

1. **Service Layer:** OpenMeteoService handles all API communication
2. **Repository Pattern:** IWeatherRepository interface with implementation
3. **Provider Pattern:** Riverpod FutureProviders for reactive state
4. **Caching:** Multi-layer caching (service, repository, providers)
5. **Error Handling:** Retry mechanism with exponential backoff
6. **Model Unification:** DailyWeatherPoint supports both raw and enriched data

## Missing Components (Not Found)

- `WeatherBloc` - Not found (uses Riverpod instead)
- `WeatherCubit` - Not found (uses Riverpod instead)
- `weatherBox` - Not found (no Hive box specifically for weather)
- `WeatherService` - Not found (named `OpenMeteoService` instead)

## Dependencies

- **dio:** HTTP client for API calls
- **flutter_riverpod:** State management
- **hive:** Local persistence
- **geolocator:** Location services
- **No dedicated weather package** (removed in G8)
