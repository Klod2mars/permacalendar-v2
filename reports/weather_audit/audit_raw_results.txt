WEATHER AUDIT RAW RESULTS
=======================
Mission: READ-WEATHER-20251102_173648
Date: 2025-11-02
Scope: permacalendar_v2_weather

SEARCH TOKENS:
- weather
- meteo
- openmeteo
- open_meteo
- open-meteo
- forecast
- Weather
- weatherBox
- weather_repository
- WeatherService
- current_weather
- weather_widget
- WeatherBloc
- WeatherCubit

FILES WITH WEATHER-RELATED CODE:
================================

CORE SERVICES:
--------------
lib/core/services/open_meteo_service.dart
  - OpenMeteoService class (singleton)
  - fetchPrecipitation() method
  - resolveCoordinates() method
  - searchPlaces() method
  - Cache with 30min TTL
  - Retry mechanism (3 attempts)

lib/core/services/weather_impact_analyzer.dart
  - WeatherImpactAnalyzer class
  - analyzeImpact() method
  - _detectWeatherAlertsProactive() method
  - _analyzeWeatherTrendsWithForecast() method

lib/core/services/weather_alert_service.dart
  - WeatherAlertService class
  - generateAlerts() method
  - Smart watering alerts
  - Frost/Heatwave thresholds

MODELS:
-------
lib/core/models/daily_weather_point.dart
  - DailyWeatherPoint class (unified model)
  - fromRaw() factory
  - fromEnriched() factory

lib/features/climate/domain/models/weather_view_data.dart
  - WeatherViewData model for UI

lib/features/plant_intelligence/domain/entities/weather_condition.dart
  - WeatherCondition freezed entity
  - WeatherType enum
  - WeatherImpact class
  - ImpactType enum

lib/core/services/models/composite_weather_data.dart
  - CompositeWeatherData helper model

REPOSITORIES:
-------------
lib/features/plant_intelligence/domain/repositories/i_weather_repository.dart
  - IWeatherRepository interface
  - saveWeatherCondition() method
  - getCurrentWeatherCondition() method
  - getWeatherHistory() method

lib/features/plant_intelligence/data/datasources/weather_datasource.dart
  - WeatherDataSource interface
  - WeatherDataSourceImpl implementation
  - Uses OpenMeteoService

lib/features/plant_intelligence/data/repositories/plant_intelligence_repository_impl.dart
  - PlantIntelligenceRepositoryImpl
  - Implements IWeatherRepository
  - getCurrentWeatherCondition() with caching
  - getWeatherHistory() with fallback

PROVIDERS:
----------
lib/features/climate/presentation/providers/weather_providers.dart
  - currentWeatherProvider (FutureProvider)
  - forecastProvider (FutureProvider)
  - weatherAlertsProvider (FutureProvider)
  - selectedCommuneCoordinatesProvider (FutureProvider)
  - WeatherAlert model
  - WeatherViewData usage

lib/features/climate/presentation/providers/hourly_weather_provider.dart
  - Hourly weather data provider

lib/features/climate/presentation/providers/weather_alert_provider.dart
  - Weather alert management provider

UI COMPONENTS:
--------------
lib/shared/presentation/widgets/weather_bubble_widget.dart
  - WeatherBubbleWidget (ConsumerWidget)
  - Uses currentWeatherProvider

lib/features/climate/presentation/screens/weather_detail_screen.dart
  - Weather detail screen

lib/features/climate/presentation/screens/climate_forecast_history_screen.dart
  - Forecast and history screen

lib/shared/presentation/widgets/settings/weather_settings_section.dart
  - Weather settings UI

lib/features/climate/presentation/anim/weather_halo_controller.dart
  - Weather animation controller

UTILITIES:
----------
lib/core/utils/weather_icon_mapper.dart
  - WeatherIconMapper class
  - getIconPath() method (WMO codes)
  - getWeatherDescription() method

GENERATED FILES:
----------------
lib/features/plant_intelligence/domain/entities/weather_condition.g.dart
lib/features/plant_intelligence/domain/entities/weather_condition.freezed.dart
lib/features/plant_intelligence/domain/entities/weather_condition_hive.g.dart

ASSETS:
-------
assets/weather/ - Weather assets directory
assets/weather_icons/ - Weather icon pack

CONFIGURATION:
--------------
pubspec.yaml
  - Line 42: geolocator: ^14.0.2
  - Line 42: Comment: "weather package removed (G8) - not used, replaced by direct OpenMeteo API integration"
  - Line 99: assets/weather/
  - Line 100: assets/weather_icons/

TEST FILES:
-----------
test/features/climate/presentation/weather_providers_commune_sync_test.dart

KEY FINDINGS:
=============

1. NO DEDICATED WEATHER PACKAGE
   - Removed in G8 refactor
   - Direct OpenMeteo API integration

2. CACHING STRATEGY
   - OpenMeteoService: 30min TTL in-memory cache
   - Repository: 30min cache validity
   - Cache keys: location-based

3. ERROR HANDLING
   - Retry: 3 attempts with exponential backoff
   - Timeout: 10 seconds
   - Fallback: stored coordinates if geocoding fails

4. API ENDPOINTS
   - Forecast: https://api.open-meteo.com/v1/forecast
   - Geocoding: https://geocoding-api.open-meteo.com/v1/search
   - No API key required

5. WEATHER ALERTS
   - Frost threshold: 0°C
   - Heatwave threshold: 35°C
   - Drought: 3 days without rain
   - Plant-aware alerts

6. DATA MODELS
   - DailyWeatherPoint: unified model (raw + enriched)
   - WeatherCondition: domain entity with Freezed
   - WeatherViewData: UI-ready model

7. PROVIDERS PATTERN
   - Riverpod FutureProviders
   - Async weather data fetching
   - Coordinates resolution from commune names

8. NO WEATHERBOX/BLOC/CUBIT
   - No BLoC or Cubit pattern found
   - Uses Riverpod providers instead

TEMPLATE FILES (NOT IN USE):
=============================
cursor_weather_mission_bundle_20251102_173648/templates/lib/weather/
  - These appear to be template/skeleton files
  - Not actively used in codebase

